<h1>Setup Guide: GitHub to Confluence Documentation Automation</h1>

<h2>1. What this automation does</h2>
<p>This setup automatically publishes or updates Confluence pages whenever selected files are changed in GitHub.</p>
<ul>
  <li>If page exists: it updates the page content.</li>
  <li>If page does not exist: it creates the page (optionally under a parent page).</li>
</ul>

<h2>2. Prerequisites</h2>
<ol>
  <li>GitHub repository admin/maintainer access.</li>
  <li>Confluence access to create and edit pages in target space.</li>
  <li>Atlassian API token for the publishing user.</li>
</ol>

<h2>3. Create Atlassian API token</h2>
<ol>
  <li>Open: <a href="https://id.atlassian.com/manage-profile/security/api-tokens">https://id.atlassian.com/manage-profile/security/api-tokens</a></li>
  <li>Create a token and copy it (shown once).</li>
  <li>Store it securely; do not commit it to source control.</li>
</ol>

<h2>4. Add required repository secrets</h2>
<p>In GitHub repository settings:</p>
<p><strong>Settings &gt; Secrets and variables &gt; Actions</strong></p>
<p>Add these secrets:</p>
<ul>
  <li><code>CONFLUENCE_BASE_URL</code> (example: <code>https://your-org.atlassian.net</code>)</li>
  <li><code>CONFLUENCE_EMAIL</code> (publishing user email)</li>
  <li><code>CONFLUENCE_API_TOKEN</code> (token from Step 3)</li>
</ul>

<h2>5. Prepare content source files</h2>
<p>Create one HTML file per page using Confluence storage format.</p>
<p>Example structure:</p>
<ul>
  <li><code>docs/confluence-page-1.storage.html</code></li>
  <li><code>docs/confluence-page-2.storage.html</code></li>
</ul>

<h2>6. Configure the workflow</h2>
<p>Create a GitHub Actions workflow that:</p>
<ul>
  <li>runs on push to your main branch</li>
  <li>supports manual trigger (<code>workflow_dispatch</code>)</li>
  <li>runs an upsert script for each Confluence page</li>
</ul>

<p>For each page, pass:</p>
<ul>
  <li>Space key</li>
  <li>Page title</li>
  <li>Source file path</li>
  <li>Optional parent page ID</li>
</ul>

<h2>7. First manual run</h2>
<ol>
  <li>Open GitHub <strong>Actions</strong>.</li>
  <li>Select your Confluence sync workflow.</li>
  <li>Click <strong>Run workflow</strong>.</li>
  <li>Choose branch and run.</li>
  <li>Confirm pages were created/updated in Confluence.</li>
</ol>

<h2>8. Start using it</h2>
<ol>
  <li>Edit the source documentation HTML file(s).</li>
  <li>Commit and push changes.</li>
  <li>Workflow updates Confluence automatically.</li>
</ol>

<h2>9. Troubleshooting</h2>
<h3>Missing required secrets</h3>
<p>Ensure these exist in GitHub Actions secrets:</p>
<ul>
  <li><code>CONFLUENCE_BASE_URL</code></li>
  <li><code>CONFLUENCE_EMAIL</code></li>
  <li><code>CONFLUENCE_API_TOKEN</code></li>
</ul>

<h3>401/403 from Confluence API</h3>
<ul>
  <li>Check token validity and user permissions in target Confluence space.</li>
  <li>Confirm base URL is site root (<code>https://your-org.atlassian.net</code>), not a page URL.</li>
</ul>

<h3>No “Run workflow” button</h3>
<p>Ensure workflow includes <code>workflow_dispatch</code>.</p>

<h2>10. Security best practices</h2>
<ul>
  <li>Use secrets only; never hardcode credentials.</li>
  <li>Rotate API tokens periodically.</li>
  <li>Revoke and recreate token immediately if exposed.</li>
</ul>

